### This is a draft - the refactoring of this code into classes is ongoing.